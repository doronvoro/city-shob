<div class="task-dialog">
  <!-- Header -->
  <div class="dialog-header">
    <div class="header-content">
      <h2 class="dialog-title">{{ data.isEdit ? 'Edit Task' : 'New Task' }}</h2>
      <p class="dialog-subtitle">{{ data.isEdit ? 'Update your task details' : 'Create a new task to track' }}</p>
    </div>
    <button class="close-btn" (click)="onCancel()" title="Close">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <!-- Form Content -->
  <div class="dialog-body">
    <form [formGroup]="taskForm" class="task-form">
      <!-- Title Field -->
      <div class="form-group">
        <label class="form-label" for="title">
          Task Title
          <span class="required">*</span>
        </label>
        <input
          type="text"
          id="title"
          class="form-input"
          formControlName="title"
          placeholder="What needs to be done?"
          maxlength="200"
          [class.error]="taskForm.get('title')?.invalid && taskForm.get('title')?.touched">
        <div class="field-info">
          <span class="error-message" *ngIf="taskForm.get('title')?.hasError('required') && taskForm.get('title')?.touched">
            Please enter a task title
          </span>
          <span class="error-message" *ngIf="taskForm.get('title')?.hasError('maxlength') && taskForm.get('title')?.touched">
            Title must be 200 characters or less
          </span>
          <span class="char-count" *ngIf="taskForm.get('title')?.value">
            {{ taskForm.get('title')?.value?.length || 0 }}/200
          </span>
        </div>
      </div>

      <!-- Description Field -->
      <div class="form-group">
        <label class="form-label" for="description">Description</label>
        <textarea
          id="description"
          class="form-textarea"
          formControlName="description"
          placeholder="Add more details..."
          rows="4"
          maxlength="2000"
          [class.error]="taskForm.get('description')?.invalid && taskForm.get('description')?.touched"></textarea>
        <div class="field-info">
          <span class="error-message" *ngIf="taskForm.get('description')?.hasError('maxlength') && taskForm.get('description')?.touched">
            Description must be 2000 characters or less
          </span>
          <span class="char-count" *ngIf="taskForm.get('description')?.value">
            {{ taskForm.get('description')?.value?.length || 0 }}/2000
          </span>
        </div>
      </div>

      <!-- Priority Selector -->
      <div class="form-group">
        <label class="form-label">Priority</label>
        <div class="priority-selector">
          <label
            *ngFor="let priority of priorities"
            class="priority-option"
            [class.selected]="taskForm.get('priority')?.value === priority"
            [class]="priority.toLowerCase()">
            <input
              type="radio"
              [value]="priority"
              formControlName="priority"
              class="sr-only">
            <span class="priority-dot"></span>
            <span class="priority-label">{{ priority | titlecase }}</span>
          </label>
        </div>
      </div>

      <!-- Due Date Field -->
      <div class="form-group">
        <label class="form-label" for="dueDate">Due Date</label>
        <div class="date-input-wrapper">
          <input
            matInput
            id="dueDate"
            class="form-input date-input"
            [matDatepicker]="picker"
            formControlName="dueDate"
            placeholder="Select a date"
            readonly>
          <mat-datepicker-toggle [for]="picker" class="date-toggle">
            <svg matDatepickerToggleIcon width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
          </mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <button
            type="button"
            class="clear-date-btn"
            *ngIf="taskForm.get('dueDate')?.value"
            (click)="clearDueDate()"
            title="Clear date">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
      </div>

      <!-- Completed Checkbox (Edit mode only) -->
      <div class="form-group" *ngIf="data.isEdit">
        <label class="checkbox-wrapper">
          <input
            type="checkbox"
            formControlName="completed"
            class="sr-only">
          <span class="checkbox-visual" [class.checked]="taskForm.get('completed')?.value"></span>
          <span class="checkbox-label">Mark as completed</span>
        </label>
      </div>
    </form>
  </div>

  <!-- Footer Actions -->
  <div class="dialog-footer">
    <button class="btn btn-secondary" (click)="onCancel()">
      Cancel
    </button>
    <button
      class="btn btn-primary"
      (click)="onSave()"
      [disabled]="!taskForm.valid"
      [class.disabled]="!taskForm.valid">
      {{ data.isEdit ? 'Update Task' : 'Create Task' }}
    </button>
  </div>
</div>
